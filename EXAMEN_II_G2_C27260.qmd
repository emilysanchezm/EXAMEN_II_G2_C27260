---
title: "Tarea3_CA0204_C27260"
author: "Emily Sánchez"
subtitle: "CA0204 - Herramientas de Ciencia de Datos I"
institute: "Universidad de Costa Rica"
titlepage: false
editor: visual
format:
  html:
    self-contained: true
    embed-resources: true
---

# 1

```{r}
# Carga de paquetes
library(tidyverse)
library(readr)

# carga de txt a r 
moras <- read_csv("~/Downloads/moras.txt", 
                  col_types =  cols(SALARIO = col_character()))

moras$SALARIO <- gsub(",", ".", moras$SALARIO)


```


# 2

```{r}
# Se agregan un resumen de los 5 números por variable cuantitativa
summary(moras$IDENTIFICACION)

summary(moras$EDAD)

moras$SALARIO <- as.numeric(moras$SALARIO)
summary(moras$SALARIO)

```

# 3

```{r}
library(dplyr)

moras <- moras %>% 
  mutate(
    # Se calcula Z-score para SALARIO y se determinan los valores atípicos.
    # Se usa la formula de Z-score para la media y desviación se omiten los NAs. Note que si el valor era NA se mantendrá como NA.
    ZSCORE_SALARIO = (SALARIO - mean(SALARIO, na.rm = TRUE)) / sd(SALARIO, na.rm = TRUE),
    
    # Se compara con 1.96 los NA siempre quedan como NAs 
    ATIPICO_SALARIO = abs(ZSCORE_SALARIO) > 1.96,
    
    # Análogo a lo de arriba.
    ZSCORE_EDAD = (EDAD - mean(EDAD, na.rm = TRUE)) / sd(EDAD, na.rm = TRUE),
    ATIPICO_EDAD = abs(ZSCORE_EDAD) > 1.96
  )

```

# 4

```{r}
# Se saca el porcentaje de NAs por variable/ columna.
# Se cuentan los NAs por columna, se dividen entre el número total de observaciones y se multiplica por 100 para obtener un porcentaje.
porcentaje_na <- colSums(is.na(moras)) / nrow(moras) * 100
porcentaje_na

```

# 5 
```{r}
# Imputamos las numéricas por el promedio. 
moras$SALARIO <- ifelse(is.na(moras$SALARIO), # Condición lógica
                        mean(moras$SALARIO, na.rm = TRUE), # Si se cumple
                        moras$SALARIO) # Si no se cumple

moras$EDAD <- ifelse(is.na(moras$EDAD), 
                     mean(moras$EDAD, na.rm = TRUE), 
                     moras$EDAD)


# Se crea un función para encontrar la moda de la variable categórica.
moda <- function(x) {
  tab <- table(x)           # Se crea una tabla de frecuencias de cada tipo de aseguramiento.
  names(tab)[which.max(tab)]  # which.max() devuelve la posición del valor máximo en un vector y names (tab) devuelve los nombres de cada elemento de tab. Combinado, esta linea toma los nombres de tab y selecciona el que corresponde a la posición de la frecuencia máxima.
}

# Se imputa con la moda 
moras$TIPO_ASEGURAMIENTO[is.na(moras$TIPO_ASEGURAMIENTO)] <- moda(moras$TIPO_ASEGURAMIENTO)

```


# 6
```{r}
# Se hace una funcion que haga graficos donde se vea la cantidad de individuos por cada variable categórica. 
graficar_categorias <- function(df, var) {
  for (i in var) { # Se recorre cada nombre de cada variable 
    plot <- df %>%
      group_by(.data[[i]]) %>%   # agrupa por las categorías de la variable donde .data[[]] permite acceder los valores que contiene esa variable (columna).
      summarise(cantidad = n()) %>%  # Se cuenta por grupo la cantidad de asegurados.
      ggplot(aes(x = .data[[i]], y = cantidad, fill = .data[[i]])) + # se definen parametros x y y. Se llenan las barras dependiendo de la categoría.
      geom_bar(stat = "identity") + # Para que no cambie los parametros que se definieron en el aes. 
      labs(title = paste("Cantidad de individuos por", i), # titulo 
           x = i,
           y = "Cantidad") +
      theme_minimal() +
      theme(axis.text.x = element_blank()) # se quita los nombres de cada categoría en el eje x porque se ve redundante y para tipo_aseguramiento se ve feo. 
    print(plot)
  }
}

# Se define un vector con las columnas categóricas por graficar
categoricas <- c("SEXO", "SECTOR", "INDICADOR_ACTIVO", 
                 "INDICADOR.EXTRANJERO", "TIPO_ASEGURAMIENTO", 
                 "INDICADOR_MOROSO")

# Se llama a la función
graficar_categorias(moras, categoricas)

```








